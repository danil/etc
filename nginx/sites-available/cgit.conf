# git.kutkevich.org.

server {
    listen       80;
    server_name  git.kutkevich.org;
    root         /var/www/cgit/htdocs;
    access_log   /var/log/nginx/git.kutkevich.org.access_log;
    error_log    /var/log/nginx/git.kutkevich.org.error_log info;

    # Serve favicon.
    location = /kutkevich_org.png {
        root /var/www/cgit/htdocs;
        expires 30d;
    }

    # Serve static files.
    location ~* ^.+\.(txt)$ {
        root /var/www/cgit/htdocs;
        expires 30d;
    }

    # Serve cgit assets.
    location ~* ^.+\.(png|css)$ {
        root /var/www/cgit/htdocs/cgit;
        expires 30d;
    }

    # Proxy everything else to cgit FastCGI cluster.
    location / {
        rewrite ^/$ /cgit.cgi break;
        rewrite ^/(.+)$ /cgit.cgi/$1 break;
        fastcgi_pass  git_kutkevich_org_cluster;
        fastcgi_index  /;
        fastcgi_param  DOCUMENT_ROOT    /var/www/cgit/cgi-bin;
        fastcgi_param  SCRIPT_FILENAME  /var/www/cgit/cgi-bin/cgit.cgi;
        fastcgi_param  CGIT_CONFIG  "/etc/cgitrc.git.kutkevich.org";
        fastcgi_param  QUERY_STRING  $query_string;
        fastcgi_param  REQUEST_METHOD  $request_method;
        fastcgi_param  CONTENT_TYPE  $content_type;
        fastcgi_param  CONTENT_LENGTH  $content_length;
        fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;
        fastcgi_param  SERVER_SOFTWARE  nginx;
        fastcgi_param  SCRIPT_NAME  $fastcgi_script_name;
        fastcgi_param  REQUEST_URI  $request_uri;
        fastcgi_param  DOCUMENT_URI  $document_uri;
        fastcgi_param  DOCUMENT_ROOT  $document_root;
        fastcgi_param  SERVER_PROTOCOL  $server_protocol;
        fastcgi_param  REMOTE_ADDR  $remote_addr;
        fastcgi_param  REMOTE_PORT  $remote_port;
        fastcgi_param  SERVER_ADDR  $server_addr;
        fastcgi_param  SERVER_PORT  $server_port;
        fastcgi_param  SERVER_NAME  $server_name;
    }
}
